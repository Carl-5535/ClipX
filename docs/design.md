# ClipX è®¾è®¡æ–‡æ¡£

ç‰ˆæœ¬: 1.0
æ›´æ–°æ—¥æœŸ: 2026-02-22

---

## ç›®å½•

1. [æ¦‚è¿°](#1-æ¦‚è¿°)
2. [è®¾è®¡åŸåˆ™](#2-è®¾è®¡åŸåˆ™)
3. [ç³»ç»Ÿæ¶æ„](#3-ç³»ç»Ÿæ¶æ„)
4. [è¿›ç¨‹æ¨¡å‹](#4-è¿›ç¨‹æ¨¡å‹)
5. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#5-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
6. [æ•°æ®åº“è®¾è®¡](#6-æ•°æ®åº“è®¾è®¡)
7. [IPC é€šä¿¡åè®®](#7-ipc-é€šä¿¡åè®®)
8. [é…ç½®ç³»ç»Ÿ](#8-é…ç½®ç³»ç»Ÿ)
9. [UI/UX è®¾è®¡](#9-uiux-è®¾è®¡)
10. [çƒ­é”®ç³»ç»Ÿ](#10-çƒ­é”®ç³»ç»Ÿ)
11. [æ”¯æŒçš„å‰ªè´´æ¿æ ¼å¼](#11-æ”¯æŒçš„å‰ªè´´æ¿æ ¼å¼)
12. [æœç´¢åŠŸèƒ½](#12-æœç´¢åŠŸèƒ½)
13. [é”™è¯¯å¤„ç†](#13-é”™è¯¯å¤„ç†)
14. [æ€§èƒ½ä¼˜åŒ–](#14-æ€§èƒ½ä¼˜åŒ–)
15. [æ‰©å±•æœºåˆ¶](#15-æ‰©å±•æœºåˆ¶)

---

## 1. æ¦‚è¿°

### 1.1 èƒŒæ™¯

Windows åŸç”Ÿå‰ªè´´æ¿å†å²è®°å½•åŠŸèƒ½ï¼ˆWin+Vï¼‰å­˜åœ¨ä»¥ä¸‹å±€é™ï¼š

| é—®é¢˜ | å½±å“ |
|------|------|
| å†å²æ¡æ•°é™åˆ¶ï¼ˆé»˜è®¤25æ¡ï¼‰ | æ— æ³•ä¿ç•™é•¿æœŸå·¥ä½œè®°å½• |
| é‡å¯åå†å²ä¸¢å¤± | é‡è¦å†…å®¹éœ€è¦æ‰‹åŠ¨å¤‡ä»½ |
| æ— æœç´¢åŠŸèƒ½ | æŸ¥æ‰¾å†å²å†…å®¹æ•ˆç‡ä½ |
| æ— æ‰©å±•èƒ½åŠ› | æ— æ³•è‡ªå®šä¹‰åŠŸèƒ½ |
| æœ‰é™çš„æ•°æ®ç±»å‹ | ä»…æ”¯æŒæ–‡æœ¬ã€HTMLã€å›¾ç‰‡ |

### 1.2 ç›®æ ‡

å¼€å‘ä¸€ä¸ª**è¶…è½»é‡çº§ã€æœ¬åœ°æŒä¹…åŒ–ã€æ— æ¡æ•°é™åˆ¶ã€é£æ ¼æ¥è¿‘ Win+V** çš„å‰ªè´´æ¿å¢å¼ºå·¥å…·ã€‚

### 1.3 éç›®æ ‡

- ä¸åšäº‘åŒæ­¥
- ä¸åšåŠ å¯†å­˜å‚¨
- ä¸åšè·¨å¹³å°
- ä¸åšå¤æ‚çš„æƒé™ç®¡ç†

---

## 2. è®¾è®¡åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| æç®€æ¶æ„ | åŒè¿›ç¨‹æ¨¡å‹ï¼Œæœ€å°ä¾èµ– |
| ä½å†…å­˜å ç”¨ | ç›®æ ‡ < 10MB å¸¸é©»å†…å­˜ |
| å¿«é€Ÿå¯åŠ¨ | å†·å¯åŠ¨ < 500ms |
| æœ¬åœ°ä¼˜å…ˆ | æ— ç½‘ç»œä¾èµ– |
| å¯æ‰©å±• | é¢„ç•™æ’ä»¶æ¥å£ |

---

## 3. ç³»ç»Ÿæ¶æ„

### 3.1 ç»„ä»¶æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ClipX ç³»ç»Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ClipD.exe (åå°å®ˆæŠ¤è¿›ç¨‹)             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚ Clipboard   â”‚  â”‚ DataManager â”‚  â”‚   IPC    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚ Listener    â”‚â”€â”€â–¶â”‚ (SQLite)    â”‚â”€â”€â–¶â”‚  Server  â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                          â”‚                              â”‚
â”‚                          â”‚ Named Pipe                   â”‚
â”‚                          â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Overlay.exe (UI æµ®å±‚ç¨‹åº)            â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚    IPC      â”‚  â”‚  ViewModel  â”‚  â”‚    UI    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚   Client    â”‚â”€â”€â–¶â”‚   Manager   â”‚â”€â”€â–¶â”‚ Renderer â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ–‡ä»¶ç»“æ„

```
ClipX/
â”œâ”€â”€ ClipD.exe                 # åå°å®ˆæŠ¤è¿›ç¨‹
â”œâ”€â”€ Overlay.exe               # UI æµ®å±‚ç¨‹åº
â”œâ”€â”€ clipx.db                  # SQLite æ•°æ®åº“
â”œâ”€â”€ config.json               # é…ç½®æ–‡ä»¶
â””â”€â”€ logs/
    â””â”€â”€ clipx.log             # æ—¥å¿—æ–‡ä»¶
```

---

## 4. è¿›ç¨‹æ¨¡å‹

### 4.1 åŒè¿›ç¨‹æ¶æ„

| è¿›ç¨‹ | èŒè´£ | ç”Ÿå‘½å‘¨æœŸ |
|------|------|----------|
| ClipD.exe | ç›‘å¬å‰ªè´´æ¿ã€æ•°æ®å­˜å‚¨ã€IPC æœåŠ¡ | ç”¨æˆ·ç™»å½•åå¸¸é©»è¿è¡Œ |
| Overlay.exe | UI å±•ç¤ºã€ç”¨æˆ·äº¤äº’ | æŒ‰éœ€å¯åŠ¨ï¼Œä½¿ç”¨å®Œæ¯•åé€€å‡º |

### 4.2 è¿›ç¨‹é€šä¿¡

- **é€šä¿¡æ–¹å¼**: Windows Named Pipe
- **ç®¡é“åç§°**: `\\.\pipe\ClipX_IPC`
- **é€šä¿¡æ¨¡å¼**: è¯·æ±‚-å“åº”ï¼ˆåŒæ­¥ï¼‰+ äº‹ä»¶é€šçŸ¥ï¼ˆå¼‚æ­¥ï¼‰

### 4.3 è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ClipD.exe                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯åŠ¨ â”€â”€â–¶ åˆå§‹åŒ– â”€â”€â–¶ ç›‘å¬å‰ªè´´æ¿ â”€â”€â–¶ ç­‰å¾… IPC è¯·æ±‚        â”‚
â”‚                          â”‚                              â”‚
â”‚                          â–¼                              â”‚
â”‚                    [æ”¶åˆ°é€€å‡ºä¿¡å·] â”€â”€â–¶ æ¸…ç† â”€â”€â–¶ é€€å‡º      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Overlay.exe                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çƒ­é”®è§¦å‘ â”€â”€â–¶ å¯åŠ¨ â”€â”€â–¶ è¿æ¥ IPC â”€â”€â–¶ è·å–æ•°æ® â”€â”€â–¶ æ¸²æŸ“ UI â”‚
â”‚                                               â”‚         â”‚
â”‚                                               â–¼         â”‚
â”‚               [ç”¨æˆ·é€‰æ‹©/å–æ¶ˆ] â”€â”€â–¶ å†™å…¥å‰ªè´´æ¿ â”€â”€â–¶ é€€å‡º    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 5.1 ClipboardListenerï¼ˆå‰ªè´´æ¿ç›‘å¬å™¨ï¼‰

**èŒè´£**: ç›‘å¬ç³»ç»Ÿå‰ªè´´æ¿å˜åŒ–ï¼Œè¯»å–å†…å®¹å¹¶å‘é€ç»™ DataManager å­˜å‚¨ã€‚

**æŠ€æœ¯å®ç°**:

```cpp
// ä½¿ç”¨ Win32 API ç›‘å¬å‰ªè´´æ¿
class ClipboardListener {
public:
    void Start();
    void Stop();

private:
    HWND m_hwnd;
    std::function<void(ClipboardData)> m_onClipboardChange;

    // Win32 æ¶ˆæ¯å¤„ç†
    LRESULT WndProc(HWND hwnd, UINT msg, WPARAM wParam, LPARAM lParam);
};

// æ³¨å†Œç›‘å¬
AddClipboardFormatListener(hwnd);

// æ¶ˆæ¯å¤„ç†
case WM_CLIPBOARDUPDATE:
    // è¯»å–å‰ªè´´æ¿å†…å®¹
    // è°ƒç”¨ DataManager å­˜å‚¨
    break;
```

**æ•°æ®æµ**:

```
Windows Clipboard
       â”‚
       â”‚ WM_CLIPBOARDUPDATE
       â–¼
ClipboardListener
       â”‚
       â”‚ ClipboardData
       â–¼
  DataManager
       â”‚
       â”‚ SQL INSERT
       â–¼
   SQLite DB
```

### 5.2 DataManagerï¼ˆæ•°æ®ç®¡ç†å™¨ï¼‰

**èŒè´£**: ç®¡ç†å‰ªè´´æ¿å†å²çš„å­˜å‚¨ã€æŸ¥è¯¢ã€åˆ é™¤ã€‚

**æ ¸å¿ƒæ¥å£**:

```cpp
class DataManager {
public:
    // åˆå§‹åŒ–æ•°æ®åº“è¿æ¥
    bool Initialize(const std::string& dbPath);

    // å­˜å‚¨å‰ªè´´æ¿æ•°æ®
    int64_t Insert(const ClipboardData& data);

    // æŸ¥è¯¢å†å²è®°å½•
    std::vector<ClipboardEntry> Query(const QueryOptions& options);

    // æœç´¢
    std::vector<ClipboardEntry> Search(const std::string& keyword);

    // åˆ é™¤
    bool Delete(int64_t id);
    bool DeleteOlderThan(int64_t timestamp);
    bool DeleteAll();

    // è·å–ç»Ÿè®¡ä¿¡æ¯
    size_t GetTotalCount();
    size_t GetDatabaseSize();

private:
    sqlite3* m_db;
    std::mutex m_mutex;
};

struct ClipboardEntry {
    int64_t id;
    int64_t timestamp;
    ClipboardDataType type;
    std::vector<uint8_t> data;
    std::string preview;      // ç”¨äºæ˜¾ç¤ºçš„é¢„è§ˆæ–‡æœ¬
    std::string sourceApp;    // æ¥æºåº”ç”¨ï¼ˆå¯é€‰ï¼‰
    int32_t copyCount;        // å¤åˆ¶æ¬¡æ•°ï¼ˆç”¨äºæ™ºèƒ½æ’åºï¼‰
};

struct QueryOptions {
    int limit = 100;
    int offset = 0;
    ClipboardDataType filterType = ClipboardDataType::All;
    SortOrder sortOrder = SortOrder::LatestFirst;
};
```

### 5.3 IPC Serverï¼ˆClipD ç«¯ï¼‰

**èŒè´£**: æ¥æ”¶ Overlay çš„è¯·æ±‚ï¼Œè¿”å›æ•°æ®æˆ–æ‰§è¡Œæ“ä½œã€‚

**å®ç°**:

```cpp
class IPCServer {
public:
    bool Start(const std::string& pipeName);
    void Stop();
    void SetHandler(std::function<IPCResponse(IPCRequest)> handler);

private:
    HANDLE m_pipe;
    std::thread m_listenerThread;
    bool m_running;

    void ListenLoop();
    IPCResponse ProcessRequest(const IPCRequest& request);
};
```

### 5.4 IPC Clientï¼ˆOverlay ç«¯ï¼‰

**èŒè´£**: å‘ ClipD å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ã€‚

**å®ç°**:

```cpp
class IPCClient {
public:
    bool Connect(const std::string& pipeName, int timeoutMs = 5000);
    void Disconnect();
    IPCResponse SendRequest(const IPCRequest& request);

    // å¼‚æ­¥é€šçŸ¥è®¢é˜…
    void Subscribe(const std::string& eventType,
                   std::function<void(IPCNotification)> callback);

private:
    HANDLE m_pipe;
    bool m_connected;
};
```

### 5.5 HotkeyManagerï¼ˆçƒ­é”®ç®¡ç†å™¨ï¼‰

**èŒè´£**: æ³¨å†Œå’Œç®¡ç†å…¨å±€çƒ­é”®ã€‚

**å®ç°**:

```cpp
class HotkeyManager {
public:
    bool RegisterHotkey(int id, UINT modifiers, UINT vk);
    bool UnregisterHotkey(int id);
    void SetHandler(int id, std::function<void()> handler);

private:
    HWND m_hwnd;
    std::unordered_map<int, std::function<void()>> m_handlers;
};

// çƒ­é”®æ¶ˆæ¯å¤„ç†
case WM_HOTKEY:
    if (auto it = m_handlers.find(wParam); it != m_handlers.end()) {
        it->second();
    }
    break;
```

---

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 è¡¨ç»“æ„

```sql
-- å‰ªè´´æ¿å†å²ä¸»è¡¨
CREATE TABLE clipboard_entries (
    id              INTEGER PRIMARY KEY AUTOINCREMENT,
    timestamp       INTEGER NOT NULL,           -- Unix æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰
    type            INTEGER NOT NULL,           -- æ•°æ®ç±»å‹æšä¸¾
    data            BLOB NOT NULL,              -- åŸå§‹æ•°æ®
    preview         TEXT,                       -- é¢„è§ˆæ–‡æœ¬ï¼ˆç”¨äºæ˜¾ç¤ºå’Œæœç´¢ï¼‰
    source_app      TEXT,                       -- æ¥æºåº”ç”¨åç§°
    hash            BLOB NOT NULL,              -- æ•°æ®å“ˆå¸Œï¼ˆç”¨äºå»é‡ï¼‰
    copy_count      INTEGER DEFAULT 1,          -- å¤åˆ¶æ¬¡æ•°
    is_favorited    INTEGER DEFAULT 0,          -- æ˜¯å¦æ”¶è—
    created_at      INTEGER NOT NULL,
    updated_at      INTEGER NOT NULL
);

-- ç´¢å¼•
CREATE INDEX idx_timestamp ON clipboard_entries(timestamp DESC);
CREATE INDEX idx_type ON clipboard_entries(type);
CREATE INDEX idx_hash ON clipboard_entries(hash);
CREATE INDEX idx_favorited ON clipboard_entries(is_favorited);

-- FTS5 å…¨æ–‡æœç´¢è™šæ‹Ÿè¡¨ï¼ˆç”¨äºæ–‡æœ¬å†…å®¹æœç´¢ï¼‰
CREATE VIRTUAL TABLE clipboard_search USING fts5(
    preview,
    content='clipboard_entries',
    content_rowid='id'
);

-- è§¦å‘å™¨ï¼šä¿æŒ FTS ç´¢å¼•åŒæ­¥
CREATE TRIGGER clipboard_ai AFTER INSERT ON clipboard_entries BEGIN
    INSERT INTO clipboard_search(rowid, preview)
    VALUES (new.id, new.preview);
END;

CREATE TRIGGER clipboard_ad AFTER DELETE ON clipboard_entries BEGIN
    INSERT INTO clipboard_search(clipboard_search, rowid, preview)
    VALUES ('delete', old.id, old.preview);
END;

CREATE TRIGGER clipboard_au AFTER UPDATE ON clipboard_entries BEGIN
    INSERT INTO clipboard_search(clipboard_search, rowid, preview)
    VALUES ('delete', old.id, old.preview);
    INSERT INTO clipboard_search(rowid, preview)
    VALUES (new.id, new.preview);
END;
```

### 6.2 æ•°æ®ç±»å‹æšä¸¾

```cpp
enum class ClipboardDataType : int32_t {
    Text        = 1,    // çº¯æ–‡æœ¬
    Html        = 2,    // HTML æ ¼å¼
    Rtf         = 3,    // RTF æ ¼å¼
    Image       = 4,    // ä½å›¾å›¾åƒ
    Files       = 5,    // æ–‡ä»¶åˆ—è¡¨
    Custom      = 99    // è‡ªå®šä¹‰æ ¼å¼
};
```

### 6.3 æ•°æ®å»é‡ç­–ç•¥

ä½¿ç”¨ SHA-256 å“ˆå¸Œè¿›è¡Œå†…å®¹å»é‡ï¼š

```cpp
std::vector<uint8_t> ComputeHash(const std::vector<uint8_t>& data);

// æ’å…¥æ—¶æ£€æŸ¥
if (DataManager::ExistsByHash(hash)) {
    // æ›´æ–° copy_count å’Œ timestamp
    DataManager::UpdateExisting(hash, newTimestamp);
} else {
    // æ’å…¥æ–°è®°å½•
    DataManager::Insert(data);
}
```

---

## 7. IPC é€šä¿¡åè®®

### 7.1 æ¶ˆæ¯æ ¼å¼

æ‰€æœ‰ IPC æ¶ˆæ¯ä½¿ç”¨ JSON æ ¼å¼ï¼š

```cpp
// è¯·æ±‚
struct IPCRequest {
    std::string action;         // æ“ä½œç±»å‹
    int32_t request_id;         // è¯·æ±‚ IDï¼ˆç”¨äºåŒ¹é…å“åº”ï¼‰
    nlohmann::json params;      // å‚æ•°
};

// å“åº”
struct IPCResponse {
    int32_t request_id;         // å¯¹åº”çš„è¯·æ±‚ ID
    bool success;               // æ˜¯å¦æˆåŠŸ
    nlohmann::json data;        // è¿”å›æ•°æ®
    std::string error;          // é”™è¯¯ä¿¡æ¯ï¼ˆå¤±è´¥æ—¶ï¼‰
};

// å¼‚æ­¥é€šçŸ¥
struct IPCNotification {
    std::string event;          // äº‹ä»¶ç±»å‹
    nlohmann::json data;        // äº‹ä»¶æ•°æ®
};
```

### 7.2 æ”¯æŒçš„æ“ä½œ

| Action | æè¿° | å‚æ•° | è¿”å› |
|--------|------|------|------|
| `ping` | å¿ƒè·³æ£€æµ‹ | - | `{ "pong": true }` |
| `get_history` | è·å–å†å²åˆ—è¡¨ | `limit`, `offset`, `type` | `ClipboardEntry[]` |
| `search` | æœç´¢å†å² | `keyword`, `limit` | `ClipboardEntry[]` |
| `get_entry` | è·å–å•æ¡è¯¦æƒ… | `id` | `ClipboardEntry` |
| `set_clipboard` | å†™å…¥å‰ªè´´æ¿ | `id` | `{ "success": true }` |
| `delete_entry` | åˆ é™¤æ¡ç›® | `id` | `{ "success": true }` |
| `toggle_favorite` | åˆ‡æ¢æ”¶è— | `id` | `{ "success": true }` |
| `get_stats` | è·å–ç»Ÿè®¡ä¿¡æ¯ | - | `{ "count": N, "size": N }` |
| `clear_all` | æ¸…ç©ºå†å² | - | `{ "success": true }` |

### 7.3 å¼‚æ­¥é€šçŸ¥äº‹ä»¶

| Event | æè¿° | æ•°æ® |
|-------|------|------|
| `clipboard_changed` | å‰ªè´´æ¿å†…å®¹å˜åŒ– | `ClipboardEntry` |
| `entry_deleted` | æ¡ç›®è¢«åˆ é™¤ | `{ "id": N }` |
| `config_changed` | é…ç½®å˜æ›´ | `config.json` å†…å®¹ |

### 7.4 ç¤ºä¾‹

**è¯·æ±‚å†å²åˆ—è¡¨**:

```json
{
    "action": "get_history",
    "request_id": 1,
    "params": {
        "limit": 50,
        "offset": 0,
        "type": 0
    }
}
```

**å“åº”**:

```json
{
    "request_id": 1,
    "success": true,
    "data": {
        "entries": [
            {
                "id": 1,
                "timestamp": 1708600000000,
                "type": 1,
                "preview": "Hello World",
                "source_app": "notepad.exe",
                "copy_count": 3,
                "is_favorited": false
            }
        ],
        "total": 100
    }
}
```

---

## 8. é…ç½®ç³»ç»Ÿ

### 8.1 é…ç½®æ–‡ä»¶æ ¼å¼ (config.json)

```json
{
    "version": "1.0",
    "hotkey": {
        "show_overlay": {
            "modifiers": ["win", "ctrl"],
            "key": "v"
        }
    },
    "ui": {
        "width": 400,
        "max_height": 600,
        "font_size": 14,
        "theme": "system",
        "opacity": 0.95,
        "show_source_app": true,
        "show_timestamp": true,
        "preview_length": 100
    },
    "storage": {
        "max_entries": 10000,
        "max_data_size_mb": 100,
        "auto_cleanup_days": 30,
        "exclude_types": []
    },
    "behavior": {
        "auto_start": true,
        "close_on_select": true,
        "paste_after_select": true,
        "smart_sort": true,
        "deduplicate": true
    },
    "advanced": {
        "log_level": "info",
        "log_file": "logs/clipx.log",
        "db_file": "clipx.db"
    }
}
```

### 8.2 é…ç½®ç®¡ç†

```cpp
class ConfigManager {
public:
    bool Load(const std::string& path);
    bool Save(const std::string& path);

    template<typename T>
    T Get(const std::string& key, const T& defaultValue);

    template<typename T>
    void Set(const std::string& key, const T& value);

    void WatchForChanges(std::function<void()> callback);

private:
    nlohmann::json m_config;
    std::string m_path;
    std::mutex m_mutex;
};
```

---

## 9. UI/UX è®¾è®¡

### 9.1 æ•´ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æœç´¢...                              âœ•  â”‚  <- æ ‡é¢˜æ ï¼ˆæœç´¢æ¡†ï¼‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â­ Hello World                          â”‚ â”‚
â”‚ â”‚    notepad.exe Â· 2åˆ†é’Ÿå‰                â”‚ â”‚  <- å†å²æ¡ç›®ï¼ˆå¯é€‰ä¸­ï¼‰
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ğŸ“ This is a longer text that will...   â”‚ â”‚
â”‚ â”‚    chrome.exe Â· 10åˆ†é’Ÿå‰                â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ğŸ–¼ï¸ [å›¾ç‰‡é¢„è§ˆ]                           â”‚ â”‚
â”‚ â”‚    screenshot.exe Â· 1å°æ—¶å‰              â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ğŸ“ C:\Users\...\Documents               â”‚ â”‚
â”‚ â”‚    explorer.exe Â· æ˜¨å¤©                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ è®¾ç½®    ğŸ—‘ï¸ æ¸…ç©º    ğŸ“Š ç»Ÿè®¡            â”‚  <- åº•éƒ¨å·¥å…·æ 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 äº¤äº’è®¾è®¡

| æ“ä½œ | ç»“æœ |
|------|------|
| `Enter` / `åŒå‡»` | é€‰ä¸­å†…å®¹å†™å…¥å‰ªè´´æ¿ï¼Œå…³é—­æµ®å±‚ |
| `Ctrl+Enter` | é€‰ä¸­å†…å®¹å†™å…¥å‰ªè´´æ¿ï¼Œä¿æŒæµ®å±‚ |
| `Escape` | å…³é—­æµ®å±‚ |
| `â†‘` / `â†“` | ä¸Šä¸‹å¯¼èˆª |
| `Ctrl+F` | èšç„¦æœç´¢æ¡† |
| `Delete` | åˆ é™¤é€‰ä¸­æ¡ç›® |
| `Ctrl+D` | åˆ‡æ¢æ”¶è—çŠ¶æ€ |
| `å³é”®` | æ˜¾ç¤ºä¸Šä¸‹æ–‡èœå• |

### 9.3 è§†è§‰è§„èŒƒ

```cpp
struct UITheme {
    // é¢œè‰²
    uint32_t background_color = 0xF3F3F3;
    uint32_t item_color = 0xFFFFFF;
    uint32_t item_hover_color = 0xE5F3FF;
    uint32_t item_selected_color = 0xCCE8FF;
    uint32_t text_color = 0x1A1A1A;
    uint32_t text_secondary_color = 0x666666;
    uint32_t border_color = 0xE0E0E0;
    uint32_t accent_color = 0x0078D4;

    // å°ºå¯¸
    int corner_radius = 8;
    int item_height = 60;
    int padding = 12;
    int spacing = 4;
};
```

### 9.4 åŠ¨ç”»

- **æ·¡å…¥**: æµ®å±‚å‡ºç°æ—¶ 150ms æ·¡å…¥
- **æ»‘åŠ¨**: åˆ—è¡¨æ»šåŠ¨æ—¶å¹³æ»‘æ»šåŠ¨
- **é€‰ä¸­**: é€‰ä¸­é¡¹é«˜äº®è¿‡æ¸¡ 100ms

---

## 10. çƒ­é”®ç³»ç»Ÿ

### 10.1 é»˜è®¤çƒ­é”®

| çƒ­é”® | åŠŸèƒ½ |
|------|------|
| `Win+Ctrl+V` | æ˜¾ç¤º/éšè—å†å²æµ®å±‚ |
| `Win+Ctrl+Shift+V` | æ˜¾ç¤ºæ”¶è—æµ®å±‚ |

### 10.2 çƒ­é”®æ³¨å†Œ

```cpp
// åœ¨ ClipD ä¸­æ³¨å†Œå…¨å±€çƒ­é”®
bool RegisterGlobalHotkey() {
    // MOD_WIN = 0x0008, MOD_CONTROL = 0x0002
    return RegisterHotKey(
        hwnd,           // æ¥æ”¶ WM_HOTKEY çš„çª—å£
        HOTKEY_SHOW_ID, // çƒ­é”® ID
        MOD_WIN | MOD_CONTROL,  // ä¿®é¥°é”®
        'V'             // è™šæ‹Ÿé”®ç 
    );
}

// çƒ­é”®è§¦å‘æ—¶å¯åŠ¨ Overlay
case WM_HOTKEY:
    if (wParam == HOTKEY_SHOW_ID) {
        ShellExecute(NULL, "open", "Overlay.exe", NULL, NULL, SW_SHOWNORMAL);
    }
    break;
```

---

## 11. æ”¯æŒçš„å‰ªè´´æ¿æ ¼å¼

### 11.1 æ ¼å¼å¤„ç†ç­–ç•¥

| æ ¼å¼ | Windows æ ¼å¼å | å­˜å‚¨æ–¹å¼ | é¢„è§ˆç”Ÿæˆ |
|------|---------------|----------|----------|
| çº¯æ–‡æœ¬ | CF_UNICODETEXT | UTF-8 æ–‡æœ¬ | æˆªå–å‰100å­—ç¬¦ |
| HTML | CF_HTML | åŸå§‹ HTML | æå–æ–‡æœ¬å†…å®¹ |
| RTF | CF_RTF | åŸå§‹ RTF | æå–æ–‡æœ¬å†…å®¹ |
| ä½å›¾ | CF_DIB | PNG å‹ç¼© | ç”Ÿæˆç¼©ç•¥å›¾ |
| æ–‡ä»¶åˆ—è¡¨ | CF_HDROP | è·¯å¾„åˆ—è¡¨ | æ˜¾ç¤ºæ–‡ä»¶å |
| è‡ªå®šä¹‰ | CF_PRIVATEFIRST+ | åŸå§‹äºŒè¿›åˆ¶ | æ˜¾ç¤ºæ ¼å¼å |

### 11.2 æ ¼å¼è½¬æ¢

```cpp
class ClipboardFormatConverter {
public:
    // è¯»å–å‰ªè´´æ¿æ‰€æœ‰å¯ç”¨æ ¼å¼
    std::vector<ClipboardFormat> GetAvailableFormats();

    // é€‰æ‹©æœ€ä½³æ ¼å¼å­˜å‚¨
    ClipboardData ExtractBestFormat();

    // ç”Ÿæˆé¢„è§ˆæ–‡æœ¬
    std::string GeneratePreview(const ClipboardData& data);

    // å°†æ•°æ®å†™å›å‰ªè´´æ¿
    bool WriteToClipboard(const ClipboardData& data);
};
```

---

## 12. æœç´¢åŠŸèƒ½

### 12.1 æœç´¢ç­–ç•¥

1. **å‰ç¼€åŒ¹é…**: è¾“å…¥å³æ—¶è§¦å‘æœç´¢
2. **FTS5 å…¨æ–‡æœç´¢**: ä½¿ç”¨ SQLite FTS5 è¿›è¡Œé«˜æ•ˆæœç´¢
3. **æ¨¡ç³Šæœç´¢**: æ”¯æŒæ‹¼éŸ³æœç´¢ï¼ˆå¯é€‰ï¼‰
4. **é«˜äº®æ˜¾ç¤º**: æœç´¢ç»“æœé«˜äº®åŒ¹é…å…³é”®è¯

### 12.2 æœç´¢å®ç°

```sql
-- FTS5 æœç´¢æŸ¥è¯¢
SELECT e.*, snippet(clipboard_search, '[', ']', '...', 1, 32) as highlight
FROM clipboard_entries e
JOIN clipboard_search s ON e.id = s.rowid
WHERE clipboard_search MATCH ?
ORDER BY e.timestamp DESC
LIMIT 50;
```

### 12.3 æœç´¢ä¼˜åŒ–

- è¾“å…¥é˜²æŠ–ï¼ˆ300msï¼‰
- ç»“æœç¼“å­˜
- æœç´¢ç»“æœæŒ‰ç›¸å…³åº¦ + æ—¶é—´æ’åº

---

## 13. é”™è¯¯å¤„ç†

### 13.1 é”™è¯¯ç 

| é”™è¯¯ç  | æè¿° |
|--------|------|
| 0 | æˆåŠŸ |
| 1001 | IPC è¿æ¥å¤±è´¥ |
| 1002 | IPC è¶…æ—¶ |
| 2001 | æ•°æ®åº“æ‰“å¼€å¤±è´¥ |
| 2002 | æ•°æ®åº“å†™å…¥å¤±è´¥ |
| 2003 | æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ |
| 3001 | å‰ªè´´æ¿è¯»å–å¤±è´¥ |
| 3002 | å‰ªè´´æ¿å†™å…¥å¤±è´¥ |
| 4001 | é…ç½®æ–‡ä»¶è§£æå¤±è´¥ |
| 9999 | æœªçŸ¥é”™è¯¯ |

### 13.2 æ—¥å¿—ç³»ç»Ÿ

```cpp
enum class LogLevel {
    Debug,
    Info,
    Warning,
    Error
};

class Logger {
public:
    static void Init(const std::string& path, LogLevel level);
    static void Log(LogLevel level, const std::string& message);
    static void Debug(const std::string& message);
    static void Info(const std::string& message);
    static void Warning(const std::string& message);
    static void Error(const std::string& message);
};
```

---

## 14. æ€§èƒ½ä¼˜åŒ–

### 14.1 å†…å­˜ä¼˜åŒ–

- Overlay è¿›ç¨‹æŒ‰éœ€å¯åŠ¨ï¼Œä½¿ç”¨å®Œæ¯•é€€å‡º
- å›¾ç‰‡æ•°æ®å‹ç¼©å­˜å‚¨ï¼ˆPNGï¼‰
- å¤§æ–‡æœ¬æˆªæ–­å­˜å‚¨ï¼ˆå¯é…ç½®æœ€å¤§é•¿åº¦ï¼‰
- LRU ç¼“å­˜é¢„è§ˆæ•°æ®

### 14.2 å¯åŠ¨ä¼˜åŒ–

- å»¶è¿Ÿåˆå§‹åŒ–éå…³é”®æ¨¡å—
- æ•°æ®åº“è¿æ¥æ± 
- é¢„ç¼–è¯‘ SQL è¯­å¥

### 14.3 æŸ¥è¯¢ä¼˜åŒ–

- åˆç†ä½¿ç”¨ç´¢å¼•
- åˆ†é¡µæŸ¥è¯¢
- é¢„è§ˆæ•°æ®å•ç‹¬ç¼“å­˜

### 14.4 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|--------|
| ClipD å†…å­˜å ç”¨ | < 10MB |
| Overlay å¯åŠ¨æ—¶é—´ | < 200ms |
| 1000æ¡å†å²æŸ¥è¯¢ | < 50ms |
| æœç´¢å“åº”æ—¶é—´ | < 100ms |

---

## 15. æ‰©å±•æœºåˆ¶

### 15.1 æ’ä»¶ç³»ç»Ÿï¼ˆæœªæ¥ï¼‰

é¢„ç•™æ’ä»¶æ¥å£ï¼Œæ”¯æŒï¼š

- è‡ªå®šä¹‰æ•°æ®æ ¼å¼å¤„ç†å™¨
- è‡ªå®šä¹‰æœç´¢è¿‡æ»¤å™¨
- è‡ªå®šä¹‰ UI ä¸»é¢˜

### 15.2 Webhookï¼ˆæœªæ¥ï¼‰

æ”¯æŒé…ç½® Webhookï¼Œåœ¨å‰ªè´´æ¿å˜åŒ–æ—¶é€šçŸ¥å¤–éƒ¨æœåŠ¡ã€‚

### 15.3 API æ¥å£ï¼ˆæœªæ¥ï¼‰

æä¾›æœ¬åœ° HTTP APIï¼Œä¾›å…¶ä»–ç¨‹åºè°ƒç”¨ã€‚

---

## é™„å½•

### A. æŠ€æœ¯é€‰å‹ç†ç”±

| æŠ€æœ¯ | é€‰å‹ç†ç”± |
|------|----------|
| C++ | æ€§èƒ½ã€å†…å­˜æ§åˆ¶ã€åŸç”Ÿ Win32 API è®¿é—® |
| SQLite | è½»é‡çº§ã€å•æ–‡ä»¶ã€æˆç†Ÿç¨³å®š |
| Named Pipe | é«˜æ•ˆçš„æœ¬åœ° IPC æœºåˆ¶ |
| Direct2D | ç°ä»£åŒ–çš„ 2D æ¸²æŸ“ï¼Œç¡¬ä»¶åŠ é€Ÿ |
| JSON | äººç±»å¯è¯»ï¼Œæ˜“äºè°ƒè¯• |

### B. å‚è€ƒèµ„æ–™

- [Windows Clipboard API](https://docs.microsoft.com/en-us/windows/win32/dataxchg/clipboard)
- [SQLite FTS5 Extension](https://www.sqlite.org/fts5.html)
- [Direct2D Documentation](https://docs.microsoft.com/en-us/windows/win32/direct2d/direct2d-portal)

### C. ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| 1.0 | 2026-02-22 | åˆå§‹è®¾è®¡æ–‡æ¡£ |
